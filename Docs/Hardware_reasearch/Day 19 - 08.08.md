after the hike i tried to implement the the "Nuke" solution into the main digital_twin code, sadly no luck. 
Experiments show that the error in the angular distances are the same as the "Nuke" fix for few selected stars. Need to check with Didi for that. 


The uart protocol is implemented by Ivo. We think of 2 interfaces - websocket and uart. They are on top of one singular interface, that has all the commands that the raspberry can implement. 


```python
import numpy as np

# Original quaternions given
q1 = np.array([-0.05475243,  0.00503133,  0.00334414,  0.99848168])
q2 = np.array([0.53389495, -0.26937958, -0.25995519, -0.75816498])

def normalize(q):
    return q / np.linalg.norm(q)

def angle_between_quaternions(q1, q2):
    q1 = normalize(q1)
    q2 = normalize(q2)
    dot = np.abs(np.dot(q1, q2))
    dot = np.clip(dot, -1.0, 1.0)  # Clamp for safe arccos
    angle = 2 * np.arccos(dot)
    return np.degrees(angle)

# 1) (x, y, z, w) ordering
angle_xyzw = angle_between_quaternions(q1, q2)

# 2) (w, x, y, z) ordering: rearrange components
q1_wxyz = np.array([q1[3], q1[0], q1[1], q1[2]])
q2_wxyz = np.array([q2[3], q2[0], q2[1], q2[2]])
angle_wxyz = angle_between_quaternions(q1_wxyz, q2_wxyz)

angle_xyzw, angle_wxyz

```


```javascript
// capella_label_and_coords.js
// Move to Capella, print coordinates, and add a dark-gray label "capela test 1"

// Helper: convert RA in decimal degrees to "HH:MM:SS.s"
function raDegToHMS(raDeg) {
    // RA: 360 deg = 24h -> hours = raDeg / 15
    var totalHours = raDeg / 15.0;
    var H = Math.floor(totalHours);
    var mFrac = (totalHours - H) * 60.0;
    var M = Math.floor(mFrac);
    var s = (mFrac - M) * 60.0;
    // format with fixed seconds to 2 decimals
    return H + ":" + (M < 10 ? "0"+M : M) + ":" + s.toFixed(2);
}

// Helper: convert Dec in decimal degrees to "±DD:MM:SS.s"
function decDegToDMS(decDeg) {
    var sign = decDeg < 0 ? "-" : "+";
    var absDec = Math.abs(decDeg);
    var D = Math.floor(absDec);
    var mFrac = (absDec - D) * 60.0;
    var M = Math.floor(mFrac);
    var s = (mFrac - M) * 60.0;
    return sign + D + ":" + (M < 10 ? "0"+M : M) + ":" + s.toFixed(2);
}

try {
    // 1) Select object and move view to it
    core.selectObjectByName("Capella", true);      // select (pointer on)
    core.moveToObject("Capella", 1.0);             // move view to Capella in 1 second

    // short wait to ensure selection/move are done in the script (adjust if needed)
    core.wait(1.0);

    // 2) Obtain object info map
    var info = core.getObjectInfo("Capella");

    // 3) Safely read RA/Dec (current frame) and J2000 if available
    var raDeg = (typeof info["ra"] !== "undefined") ? info["ra"] : null;
    var decDeg = (typeof info["dec"] !== "undefined") ? info["dec"] : null;
    var raJ2000 = (typeof info["raJ2000"] !== "undefined") ? info["raJ2000"] : null;
    var decJ2000 = (typeof info["decJ2000"] !== "undefined") ? info["decJ2000"] : null;

    // 4) Print full info map for debug / completeness
    core.output("---- Capella: raw info map ----");
    core.output(core.mapToString(info));
    core.output("--------------------------------");

    // 5) Print nicely formatted coordinates
    if (raDeg !== null && decDeg !== null) {
        core.output("Current-frame RA  (deg): " + raDeg.toFixed(6));
        core.output("Current-frame Dec (deg): " + decDeg.toFixed(6));
        core.output("Current-frame RA  (HMS): " + raDegToHMS(raDeg));
        core.output("Current-frame Dec (DMS): " + decDegToDMS(decDeg));
    } else {
        core.output("Current-frame RA/Dec not available in getObjectInfo() result.");
    }

    if (raJ2000 !== null && decJ2000 !== null) {
        core.output("J2000 RA  (deg): " + raJ2000.toFixed(6));
        core.output("J2000 Dec (deg): " + decJ2000.toFixed(6));
        core.output("J2000 RA  (HMS): " + raDegToHMS(raJ2000));
        core.output("J2000 Dec (DMS): " + decDegToDMS(decJ2000));
    } else {
        core.output("J2000 RA/Dec not present in the info map (some Stellarium versions may omit them).");
    }

    // 6) Add a dark-gray label attached to the object.
    // Parameters: text, objectName, visible, fontSize, fontColor, side, labelDistance, style
    // Use a dark gray color like "#444444"
    var labelId = LabelMgr.labelObject("capela test 1", "Capella", true, 14, "#444444", "E", -1.0, "TextOnly");

    if (labelId >= 0) {
        core.output("Label created (id = " + labelId + "). Text: \"capela test 1\" Color: #444444");
    } else {
        core.output("Failed to create label. Ensure the object name 'Capella' is available in English in this Stellarium instance.");
    }

} catch (e) {
    core.output("Script error: " + e.toString());
}

```



```javascript
// polaris_label_and_coords.js
// Removes previous Capella label, moves to Polaris, prints coordinates, adds label "polaris test 1"

// Keep the label ID from previous script if in same Stellarium session
try {
    if (typeof labelId !== "undefined" && labelId >= 0) {
        LabelMgr.deleteLabel(labelId);
        core.output("Removed Capella label (id = " + labelId + ").");
    } else {
        core.output("No previous Capella label found to remove.");
    }
} catch (e) {
    core.output("Error while removing Capella label: " + e.toString());
}

// Helper: convert RA in decimal degrees to "HH:MM:SS.s"
function raDegToHMS(raDeg) {
    var totalHours = raDeg / 15.0;
    var H = Math.floor(totalHours);
    var mFrac = (totalHours - H) * 60.0;
    var M = Math.floor(mFrac);
    var s = (mFrac - M) * 60.0;
    return H + ":" + (M < 10 ? "0"+M : M) + ":" + s.toFixed(2);
}

// Helper: convert Dec in decimal degrees to "±DD:MM:SS.s"
function decDegToDMS(decDeg) {
    var sign = decDeg < 0 ? "-" : "+";
    var absDec = Math.abs(decDeg);
    var D = Math.floor(absDec);
    var mFrac = (absDec - D) * 60.0;
    var M = Math.floor(mFrac);
    var s = (mFrac - M) * 60.0;
    return sign + D + ":" + (M < 10 ? "0"+M : M) + ":" + s.toFixed(2);
}

try {
    // 1) Select object and move view to it
    core.selectObjectByName("Polaris", true);
    core.moveToObject("Polaris", 1.0);

    // short wait
    core.wait(1.0);

    // 2) Obtain object info
    var info = core.getObjectInfo("Polaris");

    var raDeg = (typeof info["ra"] !== "undefined") ? info["ra"] : null;
    var decDeg = (typeof info["dec"] !== "undefined") ? info["dec"] : null;
    var raJ2000 = (typeof info["raJ2000"] !== "undefined") ? info["raJ2000"] : null;
    var decJ2000 = (typeof info["decJ2000"] !== "undefined") ? info["decJ2000"] : null;

    // 3) Print raw info
    core.output("---- Polaris: raw info map ----");
    core.output(core.mapToString(info));
    core.output("--------------------------------");

    // 4) Print nicely formatted coordinates
    if (raDeg !== null && decDeg !== null) {
        core.output("Current-frame RA  (deg): " + raDeg.toFixed(6));
        core.output("Current-frame Dec (deg): " + decDeg.toFixed(6));
        core.output("Current-frame RA  (HMS): " + raDegToHMS(raDeg));
        core.output("Current-frame Dec (DMS): " + decDegToDMS(decDeg));
    } else {
        core.output("Current-frame RA/Dec not available.");
    }

    if (raJ2000 !== null && decJ2000 !== null) {
        core.output("J2000 RA  (deg): " + raJ2000.toFixed(6));
        core.output("J2000 Dec (deg): " + decJ2000.toFixed(6));
        core.output("J2000 RA  (HMS): " + raDegToHMS(raJ2000));
        core.output("J2000 Dec (DMS): " + decDegToDMS(decJ2000));
    } else {
        core.output("J2000 RA/Dec not present.");
    }

    // 5) Add dark gray label for Polaris
    var polarisLabelId = LabelMgr.labelObject("polaris test 1", "Polaris", true, 14, "#444444", "E", -1.0, "TextOnly");

    if (polarisLabelId >= 0) {
        core.output("Label created for Polaris (id = " + polarisLabelId + ").");
    } else {
        core.output("Failed to create Polaris label.");
    }

} catch (e) {
    core.output("Script error: " + e.toString());
}

```