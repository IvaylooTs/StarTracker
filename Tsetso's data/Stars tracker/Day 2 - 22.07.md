## Raspberry PI setup
Successfully boot raspberry pi with the standard Debian iso, provided from Raspberry pi Imager.

To download it use **raspberry pi imager**. 

click on "operating system" -> "Raspberry Pi (other)" -> "Raspberry Pi OS Lite (32-bit)"

The used settings to log into the raspberry can be found in the other file "Raspberry pi settings". To apply them use CNTR + SHIFT + X

After using ssh to connect to camera, updated the software with
```
sudo apt update && sudo apt full-upgrade
```

Download the needed files for the camera
```
sudo apt install imx500-all
```

after quick shutdown, pluged in the camera, test it with this command:
```
libcamera-still -o test.jpg --nopreview
```

camera output is good, and we can see objects. Needs calibration and look


check out the **camera_server.py**, which is the sample website, that can be used to access life video.


Few thinks to take into account:
On the network of the Hall2, that we are connected to, *Multicast DNS* is **not** active. I check for the IP by making **nmap** (a program for computer network analysis) search for port 22
```
nmap -p 22 --open 192.168.55.0/24
```
after powering the *pi* and waiting for a minute or two i run the same command and compare the outputs to see for new IP address. The comparison is done on random website, just google text comparison.


to connect to raspberry use:
```
ssh <username>@<ip>
```
then login with the password

I used for username: *pi* and for password: *pi*
the IP address i got when connecting to the internet was *192.168.55.160*, but this changes based on many factors (reserved IP's, connected people, if address is already taken, etc.) so check with nmap. 

# Software tests:
## The Astrometry.net test
(any pictures takes of stars, are screenshots on Stellarium version 25.2)

Attempting to use already existing code base (This is command used in Fedora Linux 42):
```
sudo dnf install astrometry astrometry-data
```
I hope this works well and we will have basic simple code and idea.
probably won't be good idea, because we kinda waste time on experimentation without direct output, just knowledge gained, but still a working solution.

After testing: I used this code 
```
solve-field your_image.fits
```
and got very good results.

### Info:
##### pros:
- All the starts are in the right place
- algorithm worked fast on my potato PC
- I think i got 95% accurate coordinates! 
##### cons:
- i need to convert the screenshot from png to **fits** file
- the image was flipped for some reason (maybe conversion problem)

This was the command used to transfer to the specific altitude 
```
core.moveToRaDec("231.399713", "37.926635");
```
Check images in `/Tsetso's data/Scripts tests/astrometry-net` 

There seems to be slightly offset than expected, still very useful!

Output I got on image `sample.fits`:
```
Reading input file 1 of 1: "sample.fits"...
Running command: /usr/bin/image2pnm --infile sample.fits --uncompressed-outfile /tmp/tmp.uncompressed.wOvF52 --outfile /tmp/tmp.ppm.JYKNem --ppm --mydir /usr/bin/solve-field
Extracting sources...
This looks like a multi-color image: processing the first image plane only.  (NAXIS=3)
simplexy: found 735 sources.
Making source extraction overlay plot -- pnmfn = /tmp/tmp.ppm.JYKNem
Solving...
Reading file "./sample.axy"...
Field 1 did not solve (index index-4119.fits, field objects 1-10).
Field 1 did not solve (index index-4118.fits, field objects 1-10).
Field 1 did not solve (index index-4117.fits, field objects 1-10).
Field 1 did not solve (index index-4116.fits, field objects 1-10).
Field 1 did not solve (index index-4115.fits, field objects 1-10).
Field 1 did not solve (index index-4114.fits, field objects 1-10).
Field 1 did not solve (index index-4113.fits, field objects 1-10).
Field 1 did not solve (index index-4112.fits, field objects 1-10).
  log-odds ratio 423.703 (1.02744e+184), 288 match, 25 conflict, 151 distractors, 437 index.
  RA,Dec = (231.371,37.9344), pixel scale 61.0399 arcsec/pix.
  Hit/miss:   Hit/miss: ++++++++++++++++++++++++++++++++++++-+++++++++++++++++++++++++++++++++++++++++++++++++-+++++++++++++
Field 1: solved with index index-4111.fits.
Field 1 solved: writing to file ./sample.solved to indicate this.
Field: sample.fits
Field center: (RA,Dec) = (231.399713, 37.926635) deg.
Field center: (RA H:M:S, Dec D:M:S) = (15:25:35.931, +37:55:35.887).
Field size: 11.3435 x 8.55101 degrees
Field rotation angle: up is -109.23 degrees E of N
Field parity: neg
Creating new FITS file "./sample.new"...
Creating index object overlay plot...
Creating annotation plot...
Your field contains:
  Part of the constellation Bootes (Boo)
  The star Nekkar (β Boo / 42 Boo)
  The star Alkalurops / Inkalunis / Clava / Venabulum (μ1 Boo / 51 Boo A)
  The star Thiba (δ Boo / 49 Boo)
  The star Ceginus (φ Boo / 54 Boo)
  The star μ2 Boo / 51 Boo B
  The star ν1 Boo / 52 Boo
  The star ν2 Boo / 53 Boo
  The star 40 Boo
  The star 50 Boo
  The star ζ1 CrB / ζ2 CrB / 7 CrB
  The star κ CrB / 11 CrB
  The star μ CrB / 6 CrB
```


#### what I think the algorithm is doing:
1. it picks some good star on the picture. I think it chooses based on which ones form a *obtuse triangle (>90 degree angle)*
2. based on this angle it finds in the catalog possible matches
3. ~~catalog can be shrunk to use only >90 angles (not sure tho, this is just my theory)~~  cannot be shrunk, because angles and stuff, don't think about it


#### repeated attempt:
seems that it works, and it is repeatable.
Maybe multiple shots can be taken and taken a medium, we can remove the offset error. There is the problem of slow computation that will make the algorithm very bad.
Possible optimizations:
- smaller catalog of stars to keep track of
- smaller threshold for mapped stars (basically if star is not bright or big enough, it will be excluded in the computations)
- faster methods calculations of angles (not sure if they exist, needs checking)


### Astronometry pytohn
Just to know there is like python script that can be used with our own star tracking. https://pypi.org/project/astrometry/
It can be useful to test our star pixel position determination, compared to already existing ones.
It is different than the other one, because it is python library ( it can be added to your code ), while the *astronometry.net* version is a separate program that can be used independently and just needs image input.

#### Attempt 1 - fail
I tried using this data send in the whatsapp group by Ivaylo
```
  Star 1: (x=959.47, y=539.61)
  Star 2: (x=1878.00, y=404.50)
  Star 3: (x=312.00, y=610.50)
  Star 4: (x=818.86, y=839.27)
  Star 5: (x=48.12, y=744.20)
  Star 6: (x=668.63, y=581.63)
  Star 7: (x=519.38, y=713.62)
  Star 8: (x=45.28, y=668.94)
  Star 9: (x=69.71, y=524.31)
  Star 10: (x=997.68, y=779.32)
  Star 11: (x=1059.28, y=987.44)
  Star 12: (x=1346.90, y=521.10)
  Star 13: (x=767.17, y=291.70)
  Star 14: (x=1133.85, y=121.50)
  Star 15: (x=353.96, y=12.16)
  Star 16: (x=858.17, y=751.07)
  Star 17: (x=22.63, y=714.57)
  Star 18: (x=1092.18, y=251.61)
  Star 19: (x=1121.52, y=897.48)
  Star 20: (x=1387.62, y=527.38)
```
This is based on our own star tracker. Sadly no information was displayed.


### things to note:
scale and arcseconds are important. We better check them out.
`scale (arcsec/pixel) ≈ (206.265 × pixel_size) / focal_length`

it is used here:
```
with astrometry.Solver(
	astrometry.series_5200.index_files(
	cache_directory="astrometry_cache",
	scales={4,5,6},)
) as solver:
```


### uhh.... github?
i was wondering why i cannot upload files on github.. Then i found that the new data is somehow... 2 GIGABYTES!?!??! WHAT DO YOU MEAN????? THERE ARE LIKE 3 PICTURES AND META DATA!!?!?

it was the astronometry cache... i'm tired..
tldr; don't try to upload libraries and enviroment variables to github


## other updates:
Arrived parts 1: camera and IMU
Arrived parts 2: arduinos, some sensors, wires, breadboard, (etc.?)
3d printer saga: nozzle - clogged, sd card slot - still broken; tried cleaning the nozzle, removing it, but it doesn't give up. slot fixed by ignoring it, used *octo pi* installed on another raspberry pi, to control the printer and upload files. new problem: z-axis offset is bad. amazing...